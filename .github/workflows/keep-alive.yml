# Keep Streamlit App Alive
# This workflow pings your Streamlit app every 6 hours to prevent it from sleeping
# Streamlit Cloud apps go dormant after ~7 days of inactivity

name: Keep Streamlit Alive

on:
  schedule:
    # Run every 6 hours (4 times per day)
    - cron: '0 */6 * * *'
  
  # Allow manual trigger from GitHub Actions tab
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Streamlit App
        run: |
          echo "üèì Pinging Streamlit app to keep it alive..."
          
          # Your Streamlit app URL (update if different)
          APP_URL="https://campus-compass.streamlit.app"
          
          # Send request with timeout and retry
          for i in 1 2 3; do
            echo "Attempt $i..."
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 "$APP_URL" || echo "000")
            
            if [ "$STATUS" = "200" ] || [ "$STATUS" = "302" ] || [ "$STATUS" = "301" ]; then
              echo "‚úÖ App is alive! Status: $STATUS"
              exit 0
            else
              echo "‚ö†Ô∏è Got status $STATUS, retrying in 30s..."
              sleep 30
            fi
          done
          
          echo "‚ùå App may be down or taking too long to wake up"
          # Don't fail the workflow - app might just be slow to wake
          exit 0

      - name: Log Timestamp
        run: |
          echo "üïê Ping completed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"

